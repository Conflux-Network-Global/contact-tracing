(this["webpackJsonpdemo-front-end"]=this["webpackJsonpdemo-front-end"]||[]).push([[0],{205:function(e){e.exports=JSON.parse('[{"inputs":[],"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"payload","type":"address"}],"name":"NewPayload","type":"event"},{"inputs":[{"internalType":"address","name":"personalPayload","type":"address"},{"internalType":"address","name":"contactPayload","type":"address"}],"name":"checkHealth","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getIndividual","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"newRegistration","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes","name":"_payload","type":"bytes"}],"name":"registerPayload","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}]')},209:function(e,t,a){"use strict";(function(e){var n=a(21),r=a.n(n),o=a(36),c=a(44),s=a(24),i=a(0),l=a.n(i),u=a(123),d=a(124),p=a(212),f=a(77),m=a(211),y=(a(239),a(38)),h=a(210),b=a.n(h),g=a(483),v=a(205),x=new b.a,w={gas:y.util.format.hex(2e6),gasPrice:y.util.unit.fromGDripToDrip(1e-7)};t.a=function(t){var a=t.reg,n=t.ind,i=l.a.useState(!!n.contractObj),h=Object(s.a)(i,2),b=h[0],E=h[1],C=l.a.useState(!0),O=Object(s.a)(C,2),j=O[0],k=O[1],S=l.a.useState({text:"",hash:"",tx:!1}),N=Object(s.a)(S,2),T=N[0],P=N[1],B=l.a.useState({text:"",hash:"",tx:!1}),M=Object(s.a)(B,2),I=M[0],J=M[1];l.a.useEffect((function(){n.contractObj||a.getIndividual().call({from:window.conflux.selectedAddress}).then((function(e){if(console.log(e),"0x0000000000000000000000000000000000000000"!==e){var t=window.confluxJS.Contract({abi:g,address:e});n.setContract(t),E(!0)}k(!1)}))}),[a,n]),l.a.useEffect((function(){var e=window.localStorage.getItem("contactTracing");if(e=JSON.parse(e),console.log(e),!T.hash&&e&&P((function(t){return Object(c.a)({},t,{hash:e[e.length-1].personal})})),T.hash&&I.hash){var t={personal:T.hash,contact:I.hash,timestamp:new Date};e?e.push(t):e=[t],window.localStorage.setItem("contactTracing",JSON.stringify(e))}}),[T.hash,I.hash]);var _=function(){var e=Object(o.a)(r.a.mark((function e(){var t,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.newRegistration().data,console.log(t),n=Object(c.a)({},w,{from:window.conflux.selectedAddress,to:a.address,data:t,storageLimit:y.util.format.hex(3e3)}),e.next=5,window.conflux.send("cfx_sendTransaction",[n]);case 5:o=e.sent,console.log(o),E(!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var t=Object(o.a)(r.a.mark((function t(a,n,s,i,l){var u,d,p,f;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==a.text){t.next=2;break}return t.abrupt("return");case 2:return n((function(e){return Object(c.a)({},e,{tx:!0})})),u=y.util.format.hex(e.from(a.text)),d=x.eth.abi.encodeFunctionCall(i.filter((function(e){return e.name===s}))[0],[u]),p=Object(c.a)({},w,{from:window.conflux.selectedAddress,to:l.address,data:d,storageLimit:y.util.format.hex(100)}),t.prev=6,t.next=9,window.conflux.send("cfx_sendTransaction",[p]);case 9:f=t.sent,console.log(f),setTimeout(Object(o.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.conflux.send("cfx_getTransactionReceipt",[f]);case 2:t=e.sent,console.log(t),a=l.abi.decodeLog(t.logs[0]).array[0],console.log(a),t&&n({text:"",hash:a,tx:!1});case 7:case"end":return e.stop()}}),e)}))),1e4),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(6),n((function(e){return Object(c.a)({},e,{tx:!1})}));case 17:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(e,a,n,r,o){return t.apply(this,arguments)}}();return l.a.createElement(l.a.Fragment,null,l.a.createElement(u.a,{variant:"caption"},"New users: Please register below."," "),l.a.createElement(d.a,{color:"primary",variant:"contained",size:"large",className:"Button",disabled:b||j,onClick:_},"Register User"),l.a.createElement(f.a,{my:1},l.a.createElement(u.a,{variant:"caption"},"Use the following to register personal payloads:"," "),l.a.createElement(f.a,{className:"ContactPage-Box"},l.a.createElement(p.a,{label:"Personal Payload",variant:"outlined",onChange:function(e){var t=e.target.value;P((function(e){return Object(c.a)({},e,{text:t})}))},value:T.text,disabled:T.tx}),T.tx?l.a.createElement(f.a,{className:"Button",justifyContent:"center"},l.a.createElement(m.a,null)):l.a.createElement(d.a,{color:"primary",variant:"contained",size:"large",className:"Button",disabled:!b,onClick:function(){return z(T,P,"registerPayload",v,a)}},"Register Payload"))),l.a.createElement(u.a,{variant:"caption"},"Use the following to track contact payloads:"," "),l.a.createElement(f.a,{className:"ContactPage-Box"},l.a.createElement(p.a,{label:"Contact Payload",variant:"outlined",onChange:function(e){var t=e.target.value;J((function(e){return Object(c.a)({},e,{text:t})}))},value:I.text,disabled:I.tx}),I.tx?l.a.createElement(f.a,{className:"Button",justifyContent:"center"},l.a.createElement(m.a,null)):l.a.createElement(d.a,{color:"primary",variant:"contained",size:"large",className:"Button",disabled:!b||!T.hash,onClick:function(){return z(I,J,"contact",g,n.contractObj)}},"Report Contact")))}}).call(this,a(5).Buffer)},224:function(e,t,a){e.exports=a(486)},229:function(e,t,a){},230:function(e,t,a){},231:function(e,t,a){},239:function(e,t,a){},247:function(e,t){},272:function(e,t){},274:function(e,t){},290:function(e,t){},415:function(e,t){},427:function(e,t){},428:function(e,t){},430:function(e,t){},483:function(e){e.exports=JSON.parse('[{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"contact","type":"address"}],"name":"NewContact","type":"event"},{"inputs":[{"internalType":"address","name":"_addressCheck","type":"address"}],"name":"checkStatus","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_payload","type":"bytes"}],"name":"contact","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getStatus","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"toggleHealth","outputs":[],"stateMutability":"nonpayable","type":"function"}]')},484:function(e,t,a){},485:function(e){e.exports=JSON.parse('{"registration":"0x8fec5d693f1ac411a56204d0ac8ba987788a6efe"}')},486:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(18),c=a.n(o),s=(a(229),a(24)),i=(a(230),a(231),a(515)),l=a(518),u=a(77),d=a(123),p=a(519),f=a(520),m=a(207),y=a.n(m),h=a(208),b=a.n(h);function g(e){var t=e.children,a=e.page,n=e.ind;return r.a.createElement(i.a,null,r.a.createElement(l.a,null,r.a.createElement(u.a,{className:"CardContainer-Box"},r.a.createElement(d.a,{variant:"h4"},"Conflux Contact Tracing"),r.a.createElement(u.a,{className:"CardContainer-SubBox"},t))),r.a.createElement(p.a,{className:"CardContainer-Buttons"},r.a.createElement(f.a,{disabled:0===a.state||1===a.state,onClick:function(){return a.set(a.state-1)},color:"primary"},r.a.createElement(y.a,null)),r.a.createElement(f.a,{disabled:0===a.state||2===a.state||!n,onClick:function(){return a.set(a.state+1)},color:"primary"},r.a.createElement(b.a,null))))}var v=a(21),x=a.n(v),w=a(36),E=a(124),C=function(e){var t=e.set,a=r.a.useState(!1),n=Object(s.a)(a,2),o=n[0],c=n[1];r.a.useEffect((function(){c(!!window.conflux)}),[]);var i=function(){var e=Object(w.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.conflux.enable();case 2:t(window.conflux);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{variant:"h6"},"To get started, please ",o?"connect to ":"install ","ConfluxPortal"),o?r.a.createElement(E.a,{color:"primary",variant:"contained",size:"large",className:"Button",onClick:i},"Connect"):r.a.createElement(E.a,{color:"primary",variant:"contained",size:"large",className:"Button",onClick:function(){window.open("https://portal.conflux-chain.org/")}},"Install ConfluxPortal"))},O=a(209),j=a(211),k=a(38),S=a(122),N=a.n(S),T=(a(484),function(e){var t=e.reg,a=e.ind,n=r.a.useState("--"),o=Object(s.a)(n,2),c=o[0],i=o[1],l=r.a.useState("--"),p=Object(s.a)(l,2),f=p[0],m=p[1],y=r.a.useState(!1),h=Object(s.a)(y,2),b=h[0],g=h[1],v=r.a.useState(!1),C=Object(s.a)(v,2),O=C[0],S=C[1];r.a.useEffect((function(){i("--"),a.getStatus().call({from:window.conflux.selectedAddress}).then((function(e){i(e?"Yes":"No")}))}),[a,b]);var T=function(e){return"No"===e||"Infected Contact"===e?"error":"inherit"},P=function(){var e=Object(w.a)(x.a.mark((function e(){var t,n,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.toggleHealth().data,n={to:a.address,from:window.conflux.selectedAddress,data:t,gas:k.util.format.hex(2e6),gasPrice:k.util.unit.fromGDripToDrip(1e-7)},e.next=4,window.conflux.send("cfx_sendTransaction",[n]);case 4:r=e.sent,console.log(r),setTimeout((function(){return g(!b)}),1e4);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(w.a)(x.a.mark((function e(){var a,n,r,o,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S(!0),a=window.localStorage.getItem("contactTracing"),a=JSON.parse(a),n=[],r=!1,!a){e.next=23;break}o=0;case 7:if(!(o<a.length)){e.next=23;break}return e.prev=8,e.next=11,t.checkHealth(a[o].personal,a[o].contact).call({from:window.conflux.selectedAddress});case 11:c=e.sent,console.log(N()().diff(a[o].timestamp,"days")),N()().diff(a[o].timestamp,"days")<28&&n.push(a[o]),c||(r=!0),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(8),console.log("Invalid pair");case 20:o++,e.next=7;break;case 23:m(r?"Infected Contact":"No Issues"),S(!1);case 26:case"end":return e.stop()}}),e,null,[[8,17]])})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{pb:3},r.a.createElement(d.a,{variant:"caption"},"Please report any updates to your health:"),r.a.createElement(d.a,{variant:"h6",color:T(c)},"Healthy:"," ","--"===c?r.a.createElement(j.a,{variant:"indeterminate",className:"health-circularProgress"}):c),r.a.createElement(E.a,{variant:"contained",size:"large",className:"Button",onClick:P,color:"primary"},"Toggle Health")),r.a.createElement(u.a,null,r.a.createElement(d.a,{variant:"caption"},"Check if contact has been infected:"," "),r.a.createElement(d.a,{variant:"h6",color:T(f)},"Status:"," ",O?r.a.createElement(j.a,{variant:"indeterminate",className:"health-circularProgress"}):f),r.a.createElement(E.a,{variant:"contained",size:"large",className:"Button",onClick:B,color:"primary"},"Check Contacts")))}),P=a(205),B=a(485);var M=function(){var e=r.a.useState(0),t=Object(s.a)(e,2),a=t[0],n=t[1],o={state:a,set:n},c=r.a.useState(),i=Object(s.a)(c,2),l=i[0],u=i[1],d=r.a.useState(),p=Object(s.a)(d,2),f=p[0],m=p[1],y=r.a.useState(),h=Object(s.a)(y,2),b=h[0],v={contractObj:b,setContract:h[1]};return r.a.useEffect((function(){if(l){n(1);var e=window.confluxJS.Contract({abi:P,address:B.registration});m(e)}}),[l]),r.a.createElement("div",{className:"App"},r.a.createElement(g,{page:o,ind:b},0===o.state&&r.a.createElement(C,{set:u}),1===o.state&&r.a.createElement(O.a,{reg:f,ind:v}),2===o.state&&r.a.createElement(T,{reg:f,ind:b})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[224,1,2]]]);
//# sourceMappingURL=main.6eb0c319.chunk.js.map